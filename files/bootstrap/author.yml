---
endpoints:
  - name: magnolia-public
    url: {{ .Env.MGNLBOOT_PUBLIC_INSTANCE }}
  - name: magnolia-author
    url: http://localhost:8080{{ .Env.MGNL_CONTEXT_PATH | default "/author" }}

playbook:
  - name: updateSuperuserPw
    endpoints:
      - magnolia-author
    method: "post"
    path: "users/system/{{ .Env.MGNLBOOT_SUPERUSER_NAME | default "superuser" }}"
    allow_failure: true
    data:
      properties:
        - name: pswd
          type: String
          values: [
            {{ bcrypt (.Env.MGNLBOOT_NEW_SUPERUSER_PW) | quote }}
          ]

  {{- if .Env.MGNL_ACTIVATION_PUBKEY }}
  - name: set_pubkey
    endpoints:
      - magnolia-author
    method: post
    path: "config/server/activation"
    allow_failure: false
    data:
      properties:
        - name: class
          type: String
          values:
          - "info.magnolia.publishing.manager.ActivationManagerAdapter"
        - name: publicKey
          type: String
          values:
            - {{ .Env.MGNL_ACTIVATION_PUBKEY | pubkey }}
  {{- end }}

  {{- if .Env.MGNL_DEFAULT_BASE_URL }}
  - name: setDefaultBaseURL
    endpoints:
      - magnolia-author
    method: "post"
    path: "config/server"
    data:
      properties:
        - name: defaultBaseUrl
          type: String
          values:
            - {{ .Env.MGNL_DEFAULT_BASE_URL | quote }}
  {{- end }}
